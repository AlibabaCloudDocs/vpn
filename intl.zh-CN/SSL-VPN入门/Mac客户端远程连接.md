# Mac客户端远程连接

本文以Mac客户端为例介绍如何通过VPN网关拨号接入VPC。

![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5498488951/p3332.png)

## 前提条件

在部署VPN网关前，请确保您的环境满足以下条件：

-   您已经创建了VPC。
-   您本地设备的私网网段和VPC的私网网段不相同，否则无法通信。
-   您的客户端可以访问Internet。

## 步骤一：创建VPN网关

完成以下操作，创建VPN网关。

1.  登录[VPN网关管理控制台](https://vpc.console.aliyun.com/vpn)。
2.  在左侧导航栏，选择**VPN** \> **VPN网关** 。
3.  在VPN网关页面，单击**创建VPN网关**。
4.  在购买页面，根据以下信息配置VPN网关，然后单击**立即购买**完成支付。
    -   **实例名称**：输入VPN网关的实例名称。

        名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、半角句号（.）、下划线（\_）和短划线（-）。

    -   **地域**：选择VPN网关的地域。

        **说明：** 确保已创建VPC的地域和VPN网关的地域相同。

    -   **专有网络**： 选择要连接的VPC。
    -   **指定交换机**：是否指定VPN网关创建在VPC中的某一个交换机下。本示例选择**否**。

        如果您选择了**是**，您还需要指定具体的**虚拟交换机**。

    -   **带宽峰值**：选择一个带宽规格。带宽规格是VPN网关所具备的公网带宽。
    -   **流量**：VPN网关默认按使用流量计费。更多信息，请参见[按量计费](/intl.zh-CN/产品定价/按量计费.md)。
    -   **IPsec-VPN**： 选择是否开启IPsec-VPN功能，IPsec-VPN功能可以将本地数据中心与VPC或不同的VPC之间进行连接。
    -   **SSL-VPN**： 选择开启SSL-VPN功能。SSL-VPN功能允许您从任何位置的单台计算机连接到VPC。
    -   **SSL连接数**： 选择您需要同时连接的客户端最大规格。

        **说明：** 本选项只有在选择开启了SSL-VPN功能后才可配置。

    -   **购买时长**：VPN网关默认按小时计费。
5.  返回VPN网关页面，查看创建的VPN网关。

    刚创建好的VPN网关的状态是准备中，约两分钟左右会变成正常状态。正常状态就表明VPN网关完成了初始化，可以正常使用了。

    **说明：** VPN网关的创建一般需要1~5分钟。


## 步骤二：创建SSL服务端

完成以下操作，创建SSL服务端。

1.  在左侧导航栏，选择**VPN** \> **SSL服务端**。
2.  在顶部菜单栏，选择SSL服务端的地域。
3.  在SSL服务端页面，单击**创建SSL服务端**。
4.  在创建SSL服务端面板，根据以下信息配置SSL服务端，然后单击**确定**。
    -   **名称**：输入SSL服务端的名称。

        名称长度为2~128个字符，以英文大小写字母或中文开头，可包含数字、下划线（\_）和短划线（-）。

    -   **VPN网关**：选择已创建的VPN网关。
    -   **本端网段**：以CIDR地址块的形式输入要连接的网络。单击**添加本端网段**添加多个本端网段，本端网段可以是任何VPC或交换机的网段，也可以是本地网络的网段。
    -   **客户端网段**：以CIDR地址块的形式输入客户端连接服务端时使用的网段。

        **说明：**

        -   请确保客户端网段和本端网段不冲突。
        -   请确保您指定的客户端网段所包含的IP地址个数是SSL-VPN连接数的4倍及以上。

            例如：您指定的客户端网段为192.168.0.0/24，系统在为客户端分配IP地址时，会先从192.168.0.0/24网段中划分出一个子网掩码为30的子网段，例如192.168.0.4/30，然后从192.168.0.4/30中分配一个IP地址供客户端使用，剩余三个IP地址会被系统占用以保证网络通信，此时一个客户端会耗费4个IP地址。因此，为保证您的客户端均能分配到IP地址，请确保您指定的客户端网段所包含的IP地址个数是SSL-VPN连接数的4倍及以上。

    -   **高级配置**：使用默认高级配置。

## 步骤三：创建并下载SSL客户端证书

1.  在左侧导航栏，选择**VPN** \> **SSL客户端**。
2.  在顶部菜单栏，选择SSL客户端的地域。
3.  在SSL客户端页面，单击**创建SSL客户端证书**。
4.  在创建客户端证书面板，输入客户端证书名称并选择对应的SSL服务端，然后单击**确定**。
5.  在SSL客户端页面，找到已创建的客户端证书，然后单击**操作**列下的**下载**。

    SSL客户端证书会下载到您本地。


## 步骤四：客户端配置

完成以下操作，配置Mac客户端。

1.  执行以下命令安装OpenVPN客户端。

    ```
    brew install openvpn
    ```

    **说明：** 如果尚未安装homebrew，先安装homebrew。

2.  将步骤三中下载的证书解压拷贝到配置目录并建立连接：
    1.  备份默认配置文件。
    2.  执行以下命令删除默认配置文件：

        ```
        rm /usr/local/etc/openvpn/*
        ```

    3.  执行以下命令将文件拷贝到配置目录：

        ```
        cp cert_location /usr/local/etc/openvpn/
        ```

        `cert_location`是步骤三中下载的证书路径，例如：/Users/example/Downloads/certs6.zip。

    4.  执行以下命令解压证书文件：

        ```
        cd  /usr/local/etc/openvpn/
        unzip /usr/local/etc/openvpn/certs6.zip
        ```

    5.  执行以下命令发起连接：

        ```
        sudo /usr/local/opt/openvpn/sbin/openvpn --config /usr/local/etc/openvpn/config.ovpn
        ```


## 步骤五：连接测试

在客户端ping已连接的VPC内的一台ECS实例，测试连通性。

**说明：** 确保测试的ECS实例的安全组规则允许客户端远程连接。更多信息，请参见[安全组应用案例ECS安全组配置操作指南](/intl.zh-CN/安全/安全组/安全组应用案例.md)。

